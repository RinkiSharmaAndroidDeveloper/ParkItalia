package com.parkitalia.android.activities;

import android.app.Dialog;
import android.content.Context;
import android.content.Intent;
import android.content.SharedPreferences;
import android.content.pm.PackageInfo;
import android.content.pm.PackageManager;
import android.content.pm.Signature;
import android.os.Bundle;
import android.support.design.widget.NavigationView;
import android.support.v4.view.GravityCompat;
import android.support.v4.widget.DrawerLayout;
import android.support.v7.app.ActionBarDrawerToggle;
import android.support.v7.widget.Toolbar;
import android.util.Base64;
import android.util.Log;
import android.view.KeyEvent;
import android.view.MenuItem;
import android.view.View;
import android.view.Window;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.TextView;
import android.widget.Toast;

import com.android.volley.Request;
import com.android.volley.RequestQueue;
import com.android.volley.Response;
import com.android.volley.VolleyError;
import com.android.volley.toolbox.StringRequest;
import com.android.volley.toolbox.Volley;
import com.facebook.FacebookSdk;
import com.facebook.login.LoginManager;
import com.google.android.gms.maps.model.LatLng;
import com.parkitalia.android.R;
import com.parkitalia.android.extra.Util;
import com.parkitalia.android.fragments.AppMapFragment;
import com.parkitalia.android.fragments.AppMapFragmentFilter;
import com.parkitalia.android.fragments.AppMapFragmentLastSearch;
import com.parkitalia.android.fragments.DashboardScreen;
import com.parkitalia.android.fragments.LandingFragment;

import org.json.JSONException;
import org.json.JSONObject;

import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;
import java.util.HashMap;

public class LandingScreen extends BaseActivity implements NavigationView.OnNavigationItemSelectedListener, View.OnClickListener
{
    int i1=0;
    int i2=0;
    int i3=0;
    int i4=0;
    int i5=0;

    String fname,lname;

    @Override
    protected void onCreate(Bundle savedInstanceState)
    {
        super.onCreate(savedInstanceState);
        FacebookSdk.sdkInitialize(this);

		setContentView(R.layout.activity_landing_screen);
        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);
        SessionManager sessionManager=new SessionManager(this);
        HashMap<String, String> user = sessionManager.getUserDetails();
        Button myAccount= (Button) findViewById(R.id.myaccount);
        Button viewtutorial= (Button) findViewById(R.id.viewtutorials);
        myAccount.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                Toast.makeText(LandingScreen.this,"My Account",Toast.LENGTH_SHORT).show();

            }
        });
        viewtutorial.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                Intent i = new Intent(LandingScreen.this, TutorialActivity.class);
                startActivity(i);            }
        });
        TextView recent_search = (TextView)findViewById(R.id.textView2);
        recent_search.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {

                SharedPreferences preferences = getSharedPreferences("PlaceShared", Context.MODE_PRIVATE);
                preferences.getString("Place_Lat", null);
                preferences.getString("PlaceAddress", null);
                String data = preferences.getString("PlaceAddress", null);
                try{
                    if(data.equals("")!=true) {
                        Log.e("daata", "equal");
                    }
                    pushAddFragments(AppMapFragmentLastSearch.getFragment(null), true, true);
                    DrawerLayout drawer = (DrawerLayout) findViewById(R.id.drawer_layout);
                    drawer.closeDrawer(GravityCompat.START);

                }catch (Exception e){

                    Toast.makeText(getApplicationContext(),"No last search",Toast.LENGTH_SHORT).show();
                }


                        }
        });

        String id=user.get(SessionManager.KEY_ID);
        String lname=user.get(SessionManager.Key_Lname);
        String fname=user.get(SessionManager.KeY_Fname);
        String email= user.get(SessionManager.KEY_EMAIL);

        Log.e("Data",id+lname+fname+email);
        setSupportActionBar(toolbar);
        String link="http://indotesting.com/parkme/webservices/user/get_userid?email="+email;
        loginapp2(link);

        try
        {
            PackageInfo info = getPackageManager().getPackageInfo("com.parkitalia.android", PackageManager.GET_SIGNATURES);
            for (Signature signature : info.signatures)
            {
                MessageDigest md = MessageDigest.getInstance("SHA");
                md.update(signature.toByteArray());
                Log.d("KeyHash:", Base64.encodeToString(md.digest(), Base64.DEFAULT));
            }
        }
        catch (PackageManager.NameNotFoundException e)
        {
        }
        catch (NoSuchAlgorithmException e)
        {
        }

        ///.....................................set dialog...........................//

        findViewById(R.id.fab).setOnClickListener(new View.OnClickListener()
        {
            @Override
            public void onClick(View view)
            {
                startActivity(new Intent(view.getContext(), Information.class));

            }
        });

        final DrawerLayout drawer = (DrawerLayout) findViewById(R.id.drawer_layout);
        ActionBarDrawerToggle toggle = new ActionBarDrawerToggle(
                this, drawer, toolbar, R.string.navigation_drawer_open, R.string.navigation_drawer_close);
        drawer.setDrawerListener(toggle);
        toggle.syncState();
        NavigationView navigationView = (NavigationView) findViewById(R.id.nav_view);
        navigationView.setNavigationItemSelectedListener(this);
        pushAddFragments(LandingFragment.getFragment(), false, false);
        Intent intent=getIntent();
        try {
            String data = intent.getStringExtra("Key_Data1");

            if (data.equals("1")) {
                Log.e("Move","move");
                pushAddFragments(DashboardScreen.getFragment(), false, true);

            } else {
                setDialog();
            }
        }catch (Exception e){
            setDialog();
        }
        findViewById(R.id.left_menu_logout).setOnClickListener(this);


        final TextView textViewfilter= (TextView) findViewById(R.id.left_menu_ApplyFilter);
        textViewfilter.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                pushAddFragments(AppMapFragmentFilter.getFragment(null), true, true);
                DrawerLayout drawer = (DrawerLayout) findViewById(R.id.drawer_layout);
                drawer.closeDrawer(GravityCompat.START);
           Log.e("DataSSS","FP"+PublicValue.fp+"PP"+PublicValue.pp+"DP"+PublicValue.dp+"MC"+PublicValue.mc+"RV"+PublicValue.rv);
            }
        });

        final   ImageView imageView1= (ImageView) findViewById(R.id.image1);
        final   ImageView imageView2= (ImageView) findViewById(R.id.image2);
        final   ImageView imageView3= (ImageView) findViewById(R.id.image3);
        final   ImageView imageView4= (ImageView) findViewById(R.id.image4);
        final   ImageView imageView5= (ImageView) findViewById(R.id.image5);
imageView1.setOnClickListener(new View.OnClickListener() {
    @Override
    public void onClick(View v) {
        i1++;

        if(i1%2==0){
            PublicValue.fp=0;
            imageView1.setImageResource(R.drawable.checkbox);

        }
        else {
            PublicValue.fp =1;

            imageView1.setImageResource(R.drawable.check);

        }

    }
});
        imageView2.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                i2++;

                if(i2%2==0){
                    PublicValue. pp=0;

                    imageView2.setImageResource(R.drawable.checkbox);

                }
                else {
                    PublicValue. pp=1;

                    imageView2.setImageResource(R.drawable.check);

                }

            }
        });
        imageView3.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                i3++;

                if(i3%2==0){
                    PublicValue.  mc=0;
                    imageView3.setImageResource(R.drawable.checkbox);

                }
                else {
                    PublicValue.  mc=1;
                    imageView3.setImageResource(R.drawable.check);

                }

            }
        });
        imageView4.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                i4++;

                if(i4%2==0){
                    PublicValue. rv=0;
                    imageView4.setImageResource(R.drawable.checkbox);

                }
                else {

                    PublicValue. rv=1;
                    imageView4.setImageResource(R.drawable.check);

                }

            }
        });
        imageView5.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                i5++;

                if(i5%2==0){
                    PublicValue.  dp=0;
                    imageView5.setImageResource(R.drawable.checkbox);

                }
                else {
                    PublicValue.   dp=1;
                    imageView5.setImageResource(R.drawable.check);

                }

            }
        });

        Button button= (Button) findViewById(R.id.resetfilter);
        button.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                i1=0;
                i2=0;
                i3=0;
                i4=0;
                i5=0;
                PublicValue.dp=0;
                PublicValue.mc=0;
                PublicValue.rv=0;
                PublicValue.fp=0;
                PublicValue.pp=0;

                imageView1.setImageResource(R.drawable.checkbox);
                imageView2.setImageResource(R.drawable.checkbox);
                imageView3.setImageResource(R.drawable.checkbox);
                imageView4.setImageResource(R.drawable.checkbox);
                imageView5.setImageResource(R.drawable.checkbox);
                DrawerLayout drawer = (DrawerLayout) findViewById(R.id.drawer_layout);
drawer.closeDrawer(GravityCompat.START);
                pushAddFragments(AppMapFragment.getFragment(null), true, true);
            }
        });
    }

    public void getLatLngSearchLoc(LatLng latLng)
    {

    }
    private void loginapp2(final String login_url)
    {
        // TODO Auto-generated method stub
        showProgressing(LandingScreen.this, String.valueOf(getText(R.string.Loader)));

        RequestQueue queue = Volley.newRequestQueue(this);

        final StringRequest jsObjRequest = new StringRequest(Request.Method.GET, login_url,
                new Response.Listener<String>()
                {

                    @Override
                    public void onResponse(String response)
                    {
                        // TODO Auto-generated method stub
                        Log.e("gggggg", "response" + response);
                        try
                        {
                            //{"status":"success","response":{"id":"103","first_name":"ramnish","last_name":"kirti","phone_no]":"","email":"ramnish@gmail.com","image":"http:\/\/indotesting.com\/parkme\/uploads\/user\/103\/1491204875_1.jpg"}}
                            JSONObject json = new JSONObject(response);
                            String response23=json.getString("response");
                            Log.e("Respo",response23);
                            JSONObject resjo=new JSONObject(response23);
                            fname=resjo.getString("first_name");
                            lname=resjo.getString("last_name");
                            Log.e(fname,lname);



                            TextView  name = (TextView)findViewById(R.id.named_disp2);
                            name.setText(fname+" "+lname);



                            hideProgressing();


                        }
                        catch (JSONException e1)
                        {
                            Util.Toast(LandingScreen.this, "Internal server error");
                            e1.printStackTrace();
                            hideProgressing();
                        }



                    }
                }, new Response.ErrorListener()
        {

            @Override
            public void onErrorResponse(VolleyError error)
            {
                // TODO Auto-generated method stub
                hideProgressing();
                Util.Toast(LandingScreen.this, "Internal server error");

            }
        }
        );

        queue.add(jsObjRequest);
    }
    @Override
    public void onBackPressed()
    {
        DrawerLayout drawer = (DrawerLayout) findViewById(R.id.drawer_layout);
        if (drawer.isDrawerOpen(GravityCompat.START))
        {
            drawer.closeDrawer(GravityCompat.START);
        }
        else
        {
            super.onBackPressed();
        }
    }

    @SuppressWarnings("StatementWithEmptyBody")
    @Override
    public boolean onNavigationItemSelected(MenuItem item)
    {
        // Handle navigation view item clicks here.
        int id = item.getItemId();

        if (id == R.id.nav_camera)
        {
            // Handle the camera action
        }
        else if (id == R.id.nav_gallery)
        {
        }
        DrawerLayout drawer = (DrawerLayout) findViewById(R.id.drawer_layout);
        drawer.closeDrawer(GravityCompat.START);
        return true;
    }

    private void setDialog()
    {
        final Dialog notiDialog = new Dialog(LandingScreen.this);
        notiDialog.requestWindowFeature(Window.FEATURE_NO_TITLE);
        notiDialog.setContentView(R.layout.dialog);
        notiDialog.setCanceledOnTouchOutside(false);

        LinearLayout view_tutorial, find_parking;
        view_tutorial = (LinearLayout) notiDialog.findViewById(R.id.view_t);
        find_parking = (LinearLayout) notiDialog.findViewById(R.id.fine_park);

        view_tutorial.setOnClickListener(new View.OnClickListener()
        {
            @Override
            public void onClick(View v)
            {
//                pushAddFragments(DashboardScreen.getFragment(), false, true);
                Intent i = new Intent(LandingScreen.this, TutorialActivity.class);
                startActivity(i);
                notiDialog.dismiss();
            }
        });

        find_parking.setOnClickListener(new View.OnClickListener()
        {
            @Override
            public void onClick(View v)
            {
                pushAddFragments(DashboardScreen.getFragment(), false, true);
                notiDialog.dismiss();
            }
        });
        notiDialog.setCancelable(false);
        notiDialog.show();
    }

    @Override
    public void onClick(View v)
    {
        switch (v.getId())
        {
            case R.id.left_menu_logout:
              //  SessionManager sessionManager=new SessionManager(LandingScreen.this);
                //sessionManager.logoutUser();
                SharedPreferences settings = getSharedPreferences("MyPref", Context.MODE_PRIVATE);
                settings.edit().clear().commit();
                SharedPreferences settings1 = getSharedPreferences("PlaceShared", Context.MODE_PRIVATE);
                settings1.edit().clear().commit();

                LoginManager.getInstance().logOut();
                //finish();
                Intent i = new Intent(LandingScreen.this, SigninActivity.class);
                startActivity(i);

                break;
        }
    }

    @Override
    public boolean onKeyDown(int keyCode, KeyEvent event)  {
        if (Integer.parseInt(android.os.Build.VERSION.SDK) > 5
                && keyCode == KeyEvent.KEYCODE_BACK
                && event.getRepeatCount() == 0) {
            Log.d("CDA", "onKeyDown Called");
            onBackPressed2();
            return true;
        }
        return super.onKeyDown(keyCode, event);
    }


    public void onBackPressed2() {
        Log.d("CDA", "onBackPressed Called");
//        Intent setIntent = new Intent(Intent.ACTION_MAIN);
//        setIntent.addCategory(Intent.CATEGORY_HOME);
//        setIntent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
//        startActivity(setIntent);
    }
}



































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































